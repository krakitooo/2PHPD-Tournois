{% extends 'admin/header.html.twig' %}

{% block title %}Ajouter un match{% endblock %}

{% block body %}
    <h1>Ajouter un match</h1>

    {{ form_start(form) }}
        {{ form_row(form.tournament) }}
        {{ form_row(form.player1) }}
        {{ form_row(form.player2) }}
        {{ form_row(form.scorePlayer1) }}
        {{ form_row(form.scorePlayer2) }}
        {{ form_row(form.matchDate) }}
        {{ form_row(form.status) }}
        <button type="submit">Créer</button>
    {{ form_end(form) }}

    <a href="{{ path('admin_sportmatches_index') }}">Retour à la liste</a>
    
<script>
document.addEventListener('DOMContentLoaded', function() {
    // On récupère le champ tournament
    const tournamentField = document.querySelector('#admin_sport_match_tournament');
    
    // On ajoute un écouteur d'événement pour actualiser les listes de joueurs
    tournamentField.addEventListener('change', function() {
        const tournamentId = this.value;
        if (!tournamentId) return;
        
        // URL corrigée pour correspondre à la route du contrôleur
        fetch(`/admin/matches/tournaments/${tournamentId}/players`)
            .then(response => response.json())
            .then(data => {
                // Mettre à jour les options des dropdowns player1 et player2
                updatePlayerDropdown('admin_sport_match_player1', data);
                updatePlayerDropdown('admin_sport_match_player2', data);
            })
            .catch(error => console.error('Error:', error));
    });
    
    function updatePlayerDropdown(selectId, players) {
        const selectElement = document.getElementById(selectId);
        // Vider le dropdown
        selectElement.innerHTML = '';
        
        // Ajouter l'option placeholder
        const placeholderOption = document.createElement('option');
        placeholderOption.value = '';
        placeholderOption.textContent = 'Choisir un joueur';
        placeholderOption.selected = true;
        selectElement.appendChild(placeholderOption);
        
        // Ajouter les options des joueurs
        players.forEach(player => {
            const option = document.createElement('option');
            option.value = player.id;
            option.textContent = player.username;
            selectElement.appendChild(option);
        });
        
        // Activer le dropdown
        selectElement.disabled = false;
    }
});
</script>
{% endblock %}