{% extends 'base.html.twig' %}

{% block title %}Tableau de bord Admin{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap.min.css">
{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
async function deleteTournament(tournamentId) {
    if (!confirm('√ätes-vous s√ªr de vouloir supprimer ce tournoi ?')) {
        return;
    }

    const response = await fetch(`/api/tournaments/${tournamentId}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json'
        },
        credentials: 'include' // Inclut les cookies dans la requ√™te
    });

    if (response.ok) {
        alert('Tournoi supprim√© avec succ√®s.');
        document.getElementById(`tournament-${tournamentId}`).remove();
    } else {
        const error = await response.json();
        alert(`Erreur lors de la suppression du tournoi : ${error.message || 'Erreur inconnue'}`);
    }
}
</script>
{% endblock %}

{% block body %}
<div class="container py-5">
  <h1 class="mb-4 text-center text-danger"><i class="bi bi-shield-lock-fill"></i> Interface d‚Äôadministration</h1>

  <div class="row g-4">
    <!-- Utilisateurs -->
    <div class="col-lg-6">
      <div class="card border-secondary shadow-sm">
        <div class="card-header bg-secondary text-white fw-bold">
          üë§ Utilisateurs
        </div>
        <div class="card-body">
          <p><strong>Total :</strong> {{ users|length }}</p>
          <ul class="list-group list-group-flush">
            {% for user in users|slice(0, 5) %}
              <li class="list-group-item">{{ user.username }} - {{ user.status }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <!-- Tournois -->
    <div class="col-lg-6">
      <div class="card border-info shadow-sm">
        <div class="card-header bg-info text-white fw-bold">
          üèÜ Tournois
        </div>
        <div class="card-body">
          <p><strong>Total :</strong> {{ tournaments|length }}</p>
          <ul class="list-group list-group-flush">
            {% for t in tournaments %}
              <li class="list-group-item d-flex justify-content-between align-items-center" id="tournament-{{ t.id }}">
                <span>{{ t.tournamentName }}</span>
                <div>
                  <a href="{{ path('tournament_show', { id: t.id }) }}" class="btn btn-sm btn-primary me-2">D√©tails</a>
                  <button class="btn btn-sm btn-danger" onclick="deleteTournament({{ t.id }})">Supprimer</button>
                </div>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>

  <hr class="my-5">

  <p class="text-muted text-center">Connect√© en tant que <strong>{{ user.username }}</strong> (admin)</p>
</div>
{% endblock %}